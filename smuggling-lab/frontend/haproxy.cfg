global
    log stdout  format raw  local0
    maxconn 4096

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5s
    timeout client  30s
    timeout server  30s

frontend fe_http
    bind *:80

    # Reject any request carrying both CL and TE
    acl has_cl req.hdr(Content-Length) -m found
    acl has_te req.hdr(Transfer-Encoding) -m found
    http-request deny status 400 content-type text/plain lf-string "Rejected: both CL and TE present" if has_cl has_te

    default_backend be_cache

backend be_cache
    mode http
    option http-server-close   # disable connection reuse to defeat smuggling
    server cache smuggling-cache:6081 check

